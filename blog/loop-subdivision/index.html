<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Loop Subdivision</title>
		<meta name="description" content="Loop Subdivision">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Joseph Li">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Joseph Li">
		
		<style>/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #645858;
	--color-gray-50: #302828;
	--color-gray-90: #333;

	--background-color: #f69e9e;

	--text-color: #000000;
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #544040;
		--color-gray-50: #614a4a;
		--color-gray-90: #000000;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #04047d;
		--text-color-link-visited: #0a0aaa;

		--background-color: #ffffff;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em .5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: .1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">Joseph Li</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/blog/">Archive</a></li>
					<li class="nav-item"><a href="/about/">About Me</a></li>
					<li class="nav-item"><a href="/resume/">Resume</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>Loop Subdivision</h1>

<ul class="post-metadata">
	<li><time datetime="2022-02-03">03 February 2022</time></li>
	<li><a href="/tags/computer-graphics/" class="post-tag">computer graphics</a></li>
</ul>

<p>For the undergraduate computer graphics course (CMSC427) last semester, we were given an optional bonus assignment. We were required to implement some additional functionality in a 3D rendering engine, and I chose Loop subdivision.</p>
<h3 id="subdivision-surfaces" tabindex="-1">Subdivision Surfaces <a class="header-anchor" href="#subdivision-surfaces">#</a></h3>
<p><a href="https://en.wikipedia.org/wiki/Loop_subdivision_surface">Loop subdivision</a> (not to be confused with the Loop Subdivide tool in Blender) is a subdivision scheme for triangle meshes. Subdivision surface algorithms are used to take a coarse mesh and generate a much smoother one. This is extremely useful for 3D modeling and for creating a high poly mesh for sculpting. The disadvantage is that each level of subdivision increases the triangle count by some multiplicative factor (4, in the case of Loop subdivision). This typically makes subdivision unsuitable for animating models, since you usually want around 30k polygons or less (unless you apply &quot;hacks&quot; like shadow baking to make your model look good).</p>
<p>Note that in Blender, since 3D artists typically prefer quads over tris in manual modeling, the Catmull-Clark algorithm is used instead. Quad meshes are better because it allows you to do loop cuts cleanly.</p>
<h3 id="winged-edge-data-structure" tabindex="-1">Winged Edge Data Structure <a class="header-anchor" href="#winged-edge-data-structure">#</a></h3>
<p>Specialized data structures are needed for these subdivision surface algorithms, in this case the <a href="https://en.wikipedia.org/wiki/Winged_edge">winged edge data structure</a>. This data structure stores a list of vertices, edges, and faces, but in some sense the edges are most important. Each edge stores a reference to its four incident vertices and two faces (in some specified order). Each vertex only needs to store one incident edge (along with its coordinate position, of course). Each face only needs to store one incident edge.</p>
<p>One way to create this winged edge data structure is to loop through all the faces, but then looping through all edges is required to make sure edges are not duplicated. It might be possible to avoid this by first adding all vertices and edges, making sure not to duplicate edges by using a hashmap. Then, you can fill out the incident faces and edges for each edge. However, as a disclaimer, I did not thoroughly test this alternate implementation.</p>
<h3 id="loop-subdivision" tabindex="-1">Loop Subdivision <a class="header-anchor" href="#loop-subdivision">#</a></h3>
<p>The Loop subdivision surface <a href="https://graphics.stanford.edu/%7Emdfisher/subdivision.html">scheme</a> basically takes each vertex in the original mesh and replaces it with a new vertex that is some convex combination of adjacent vertices. If <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span> is the degree of the vertex to be replaced, the weight <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span> for each of the adjacent vertices is <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>β</mi><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mn>3</mn><mrow><mn>8</mn><mi>n</mi></mrow></mfrac><mo separator="true">,</mo><mspace width="2em"/><mi>n</mi><mo>&gt;</mo><mn>3</mn><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mn>3</mn><mn>16</mn></mfrac><mo separator="true">,</mo><mspace width="2em"/><mi>n</mi><mo>=</mo><mn>3.</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\beta=\begin{cases} \frac{3}{8n}, \qquad n&gt;3, \newline \frac{3}{16}, \qquad n=3. \end{cases}</annotation></semantics></math></span></p>
<p>An additional vertex is also added for each edge in the original mesh. If the edge has two incident faces, the new vertex is a convex combination of the four vertices comprising those two faces. The weights for the two &quot;close&quot; vertices on the edge are each <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi mathvariant="normal">/</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">3/8</annotation></semantics></math></span>, while the weights for the two &quot;far&quot; vertices are each <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">1/8</annotation></semantics></math></span>.</p>
<p>If the edge only has a single incident face, then the new vertex is simply placed at the midpoint of the vertices making up that edge.</p>
<p>Finally, the only thing left to do is to fill in the faces.</p>
<p>This algorithm is actually quite simple and the more challenging part, surprisingly, is implementing the winged edge data structure.</p>
<p>Below are 5 levels of Loop subdivision applied onto a tetrahedron and an icosahedron.
<img src="/img/tetrahedron.png" width="600" alt="tetrahedron">
<img src="/img/icosahedron.png" width="600" alt="icosahedron"></p>
<!-- ![Tetrahedron](/img/tetrahedron.png){width=500} -->
<!-- ![Icosahedron](/img/icosahedron.png) -->
<ul class="links-nextprev"><li>Previous: <a href="/blog/qp-weak-duality/">Weak Duality for QP</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- Current page: /blog/loop-subdivision/ -->
	</body>
</html>
